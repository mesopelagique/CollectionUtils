<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Unit test result</title>
	    <style type="text/css">
table {
    width: 50%;
}
th {
    background: #f1f1f1;
    font-weight: bold;
    padding: 6px;
}
td {
    background: #f9f9f9;
    padding: 6px;
}
        </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	</head>

	<body bgcolor="#ffffff">
		<div align="center">
      <h1>Unit Tests</h1>
      <table id="myTable">
        <tr>
            <th>Name</th>
            <th>Success</th>
            <th>Duration(ms)</th>
            <th>Message</th>
        </tr>
      </table>
      <script type="text/javascript">
        function tdclick(el){
            var test = el.textContent;
            console.log(test);

            $.ajax({
            url: '4daction/actionTest',
            type: 'POST',
            data: JSON.stringify({ "test": test }),
            dataType: 'json',
            success: function(data) {
                console.log(data);
                var value = data[test];

                var success=$(el).next();
                success.text(value.success ? 'âœ…': 'ðŸš«');
                var duration=success.next();
                duration.text(value.duration);
                var message=duration.next();
                if(value.formula) {
                    message.text(value.formula);
                } else {
                    message.text("");
                }
            },
            error: function(jqXHR, textStatus, errorThrown){
                alert('Error: ' + textStatus + ' - ' + errorThrown);
            }
        });
        };
        $.ajax({
            url: '4daction/actionTests',
            dataType: 'json',
            success: function(data) {
                for (let [test, value] of Object.entries(data)) {
                    var row = '<tr><td onclick="tdclick(this)">' + test+ '</td><td align="center">';
                    row += value.success ? 'âœ…': 'ðŸš«';
                    row += '</td><td align="center">';   
                    row += value.duration;
                    row += '</td><td>';
                    if(value.formula) {
                      row +=  value.formula;
                    } 
                     row += '</td></tr>';
                  
                    $('#myTable').append($(row));
                }
            },
            error: function(jqXHR, textStatus, errorThrown){
                alert('Error: ' + textStatus + ' - ' + errorThrown);
            }
        });
        </script>
		</div>
	</body>

</html>
